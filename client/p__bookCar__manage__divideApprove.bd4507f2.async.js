(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[28],{"A/Bm":function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return w}));var n=a("k1fw"),c=a("9og8"),r=a("tJVT"),i=a("WmNS"),s=a.n(i),l=a("q1tI"),o=a("9mPY"),u=a("5Ftn"),d=a("pf/J"),v=a("D3E4"),b=a("sda0"),p=a("tU6r"),j=a("B16J"),m=a("5Ipf"),h=a("Ty5D"),x=a("9kvl"),O=a("pAFO"),f=a("nKUr"),k="boTF";function w(){var e,t,a=Object(h["h"])(),i=a,w=Object(x["e"])("@@initialState"),g=w.initialState,N=g,_=Object(l["useState"])(),y=Object(r["a"])(_,2),F=y[0],L=y[1],S=function(){var e=Object(c["a"])(s.a.mark((function e(){var t,a,n;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(O["b"])({params:{id:i.id}});case 2:return t=e.sent,e.next=5,Object(O["l"])({data:{pageNum:1,pageSize:100,admin:null===N||void 0===N?void 0:N.user.phoneNumber}});case 5:a=e.sent,t&&t.status&&a&&a.status&&(q(a.result.list,t.result),L(t.result),n=[],t.result.vehicleAssignmentFormList.forEach((e=>{n.push({applicationFormId:e.applicationFormId,driverName:e.driverName,driverMobile:e.driverMobile,vehicleInfo:e.vehicleInfo})})),ce(n));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(l["useEffect"])((()=>{S()}),[]),Object(l["useEffect"])((()=>{F&&Q()}),[F]);var A=function(){var e=Object(c["a"])(s.a.mark((function e(){var t,a;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=[],null===(t=J.vehicleList)||void 0===t||t.forEach((e=>{a.push(Object(O["n"])({data:{arrivalTime:J.arrivalTime,departureTime:J.departureTime,licensePlate:e}}))})),Promise.all(a).then((e=>{var t=e.every((e=>void 0!==e));t&&C()}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T=Object(l["useState"])(!1),M=Object(r["a"])(T,2),I=M[0],E=M[1],D=Object(l["useState"])({}),z=Object(r["a"])(D,2),J=z[0],P=z[1],C=function(){var e=Object(c["a"])(s.a.mark((function e(){var t;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!I){e.next=2;break}return e.abrupt("return");case 2:return E(!0),e.prev=3,e.next=6,Object(O["g"])({data:J});case 6:t=e.sent,t&&t.status?(d["a"].show("".concat(t.message,", \u5373\u5c06\u56de\u5230\u4e0a\u4e00\u9875")),setTimeout((()=>{x["a"].go(-1),E(!1)}),1e3)):E(!1),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](3),E(!1);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(){return e.apply(this,arguments)}}(),B=Object(l["useState"])(),V=Object(r["a"])(B,2),U=V[0],W=V[1],q=function(){var e=Object(c["a"])(s.a.mark((function e(t,a){var c,r,l;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:c=[],t.forEach((e=>{var t={value:e.licensePlate,label:Object(f["jsxs"])("div",{_nk:"".concat(k,"11"),children:[e.licensePlate,"(",e.department,",",e.seatNum,"\u5ea7)-",e.status]}),info:{driverName:e.driverName,driverMobile:e.driverMobile}};c.push(t)})),W(c),r=[a.vehicleApplicationForm.vehicleInfo],0!==(null===r||void 0===r?void 0:r.length)&&(l=[...J.driverList||[]],null===r||void 0===r||r.forEach(((e,t)=>{var a=c.find((t=>t.value===e));a&&void 0===l[t]&&(l[t]=a.info)})),P(Object(n["a"])(Object(n["a"])({},J),{},{applicationFormId:i.id,arrivalTime:null===a||void 0===a?void 0:a.vehicleApplicationForm.arrivalTime,assignorName:N.user.userName,assignorMobile:N.user.phoneNumber,departureTime:null===a||void 0===a?void 0:a.vehicleApplicationForm.departureTime,remark:null===a||void 0===a?void 0:a.vehicleApplicationForm.remark,vehicleList:r,driverList:l})));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),K=Object(l["useState"])(),Y=Object(r["a"])(K,2),G=Y[0],H=Y[1],Q=function(){var e=Object(c["a"])(s.a.mark((function e(){var t,a,n,c;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(O["m"])({data:{department:null===F||void 0===F?void 0:F.vehicleApplicationForm.department,pageNum:1,pageSize:1e3}});case 3:return t=e.sent,e.next=6,Object(O["m"])({data:{department:"\u529e\u516c\u5ba4",pageNum:1,pageSize:1e3}});case 6:a=e.sent,t&&t.status&&a&&a.status&&(n=[],c=[...t.result.list],"\u529e\u516c\u5ba4"!==(null===F||void 0===F?void 0:F.vehicleApplicationForm.department)&&(c=t.result.list.concat(a.result.list)),c.forEach((e=>{var t={value:"".concat(e.name," ").concat(e.phoneNumber),label:"".concat(e.name,"\uff08").concat(e.department,"\uff09").concat(e.phoneNumber)};n.push(t)})),H(n)),e.next=12;break;case 10:e.prev=10,e.t0=e["catch"](0);case 12:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}(),R=0===(null===F||void 0===F?void 0:F.vehicleAssignmentFormList.length)?Object(f["jsxs"])("div",{className:"m-2",_nk:"".concat(k,"12"),children:[Object(f["jsx"])("div",{className:"text-gray-400 text-base mb-1",_nk:"".concat(k,"13"),children:"\u6d3e\u8f66"}),Object(f["jsx"])(u["a"],{title:"\u8f66\u8f86\u9009\u62e9",_nk:"".concat(k,"21"),children:Object(f["jsx"])(v["a"],{dataSource:U,value:J.vehicleList&&J.vehicleList[0],onOk:e=>{var t=[];t=[e[0].info],P(Object(n["a"])(Object(n["a"])({},J),{},{driverList:t,vehicleList:[e[0].value]}))},_nk:"".concat(k,"31")})}),Object(f["jsx"])(u["a"],{title:"\u53f8\u673a\u9009\u62e9",_nk:"".concat(k,"22"),children:Object(f["jsx"])(v["a"],{dataSource:G,value:(null===J||void 0===J?void 0:J.driverList)&&"".concat(null===J||void 0===J||null===(e=J.driverList[0])||void 0===e?void 0:e.driverName," ").concat(null===J||void 0===J||null===(t=J.driverList[0])||void 0===t?void 0:t.driverMobile),onOk:e=>{P(Object(n["a"])(Object(n["a"])({},J),{},{driverList:[{driverName:e[0].value.split(" ")[0],driverMobile:e[0].value.split(" ")[1]}]}))},_nk:"".concat(k,"32")})}),Object(f["jsx"])("button",{onClick:()=>A(),className:"flex text-base font-bold justify-center flex-1 text-white bg-blue-500 py-1 px-12 my-8 rounded-full mx-auto focus:outline-none hover:bg-indigo-600",_nk:"".concat(k,"41"),children:I?"\u5904\u7406\u4e2d":"\u6d3e\u8f66"})]}):Object(f["jsx"])(f["Fragment"],{children:F&&Object(f["jsx"])(m["a"],{applyData:F,_nk:"".concat(k,"51")})}),X=Object(l["useState"])(!1),Z=Object(r["a"])(X,2),$=Z[0],ee=Z[1],te=Object(l["useState"])(),ae=Object(r["a"])(te,2),ne=ae[0],ce=ae[1],re=function(){var e=Object(c["a"])(s.a.mark((function e(){var t;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!$){e.next=2;break}return e.abrupt("return");case 2:return ee(!0),e.prev=3,e.next=6,Object(O["e"])({data:ne});case 6:t=e.sent,t&&t.status?(d["a"].show("".concat(t.message," , \u5373\u5c06\u56de\u5230\u4e0a\u4e00\u9875")),setTimeout((()=>{ee(!1),x["a"].go(-1)}),1e3)):ee(!1),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](3),ee(!1);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(){return e.apply(this,arguments)}}(),ie="\u51fa\u884c\u4e2d"===(null===F||void 0===F?void 0:F.vehicleApplicationForm.status)&&F.vehicleAssignmentFormList.map((e=>Object(f["jsxs"])("div",{className:"w-full",_nk:"iAr".concat(k,"14"),children:[Object(f["jsx"])(u["a"],{title:"\u51fa\u884c\u8f66\u8f86",_nk:"".concat(k,"23"),children:e.vehicleInfo}),Object(f["jsx"])(u["a"],{title:"\u51fa\u884c\u53f8\u673a",_nk:"".concat(k,"24"),children:Object(f["jsxs"])("div",{className:"text-blue-500 flex items-center",_nk:"".concat(k,"15"),children:[Object(f["jsxs"])("a",{href:"tel:".concat(e.driverMobile),_nk:"".concat(k,"61"),children:[e.driverName,e.driverMobile]}),Object(f["jsx"])("svg",{xmlns:"http://www.w3.org/2000/svg",className:"mx-1 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",_nk:"".concat(k,"71"),children:Object(f["jsx"])("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z",_nk:"".concat(k,"81")})})]})}),Object(f["jsx"])(u["a"],{title:"\u5f53\u524d\u72b6\u6001",_nk:"".concat(k,"25"),children:e.status}),Object(f["jsx"])("button",{onClick:re,className:"flex text-base font-bold justify-center flex-1 text-white bg-blue-500 py-1 px-12 my-8 rounded-full mx-auto focus:outline-none hover:bg-indigo-600",_nk:"".concat(k,"42"),children:$?"\u5904\u7406\u4e2d":"\u786e\u8ba4\u56de\u7a0b"})]},e.pid)));return Object(f["jsxs"])(f["Fragment"],{children:[Object(f["jsx"])("div",{className:"sticky top-0 bg-white z-10",_nk:"".concat(k,"16"),children:Object(f["jsx"])(o["a"],{title:"\u6d3e\u8f66",_nk:"".concat(k,"91")})}),Object(f["jsx"])("div",{className:"m-2",_nk:"".concat(k,"17"),children:Object(f["jsxs"])("div",{className:"text-gray-400 text-base mb-1",_nk:"".concat(k,"18"),children:["\u6d41\u7a0b\u72b6\u6001\uff1a",Object(f["jsx"])("span",{className:"border border-blue-400 bg-white text-blue-400 rounded px-1",_nk:"".concat(k,"a1"),children:null===F||void 0===F?void 0:F.vehicleApplicationForm.status})]})}),F&&Object(f["jsx"])(b["a"],{applyData:F,_nk:"".concat(k,"b1")}),F&&Object(f["jsx"])(p["a"],{applyData:F,_nk:"".concat(k,"c1")}),F&&Object(f["jsx"])(j["a"],{applyData:F,_nk:"".concat(k,"d1")}),R,ie&&Object(f["jsxs"])("div",{className:"m-2",_nk:"".concat(k,"19"),children:[Object(f["jsx"])("div",{className:"text-gray-400 text-base mb-1",_nk:"".concat(k,"1a"),children:"\u51fa\u884c\u4fe1\u606f"}),ie]})]})}}}]);