(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[52],{NQFS:function(e,t,n){"use strict";n.r(t);var c=n("k1fw"),a=n("9og8"),s=n("tJVT"),r=n("WmNS"),i=n.n(r),o=n("9mPY"),l=n("PCcL"),d=n("q1tI"),u=n("Ty5D"),j=n("9kvl"),b=n("pf/J"),x=n("VsxY"),h=n("L+2y"),p=n("nKUr"),f="S1fx",m=()=>{var e=Object(u["h"])(),t=e,n=Object(j["e"])("useWeChat"),r=n.wxPayAwake,m=Object(d["useState"])({canteenId:t.id,extraInfo:"",flag:0}),O=Object(s["a"])(m,2),v=O[0],k=O[1],w=Object(d["useState"])(0),g=Object(s["a"])(w,2),y=g[0],_=g[1],N=Object(d["useState"])(),I=Object(s["a"])(N,2),C=I[0],S=I[1],L=function(){var e=Object(a["a"])(i.a.mark((function e(t){var n,a,s;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(l["p"])({data:{canteenId:t}});case 3:n=e.sent,n&&n.status&&(a=[],s=0,n.result.forEach((e=>{e.goodsCount&&(s+=e.goodsCount*e.price,a.push({goodsId:e.pid,count:e.goodsCount}))})),k(Object(c["a"])(Object(c["a"])({},v),{},{itemList:a})),_(s),S(n.result)),e.next=9;break;case 7:e.prev=7,e.t0=e["catch"](0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),J=Object(p["jsxs"])("div",{className:"bg-white px-6 flex-1 overflow-y-scroll mx-4 rounded mt-4",_nk:"".concat(f,"11"),children:[C&&0!==C.length&&C.map(((e,t)=>{var n,c;return Object(p["jsx"])(h["a"],{id:e.categoryId,title:e.name,subTitle:e.introduction,price:e.price,actionButton:Object(p["jsxs"])("div",{className:"font-semibold",_nk:"".concat(f,"12"),children:["x ",e.goodsCount]}),img:null===(n=e.picList)||void 0===n||null===(c=n[0])||void 0===c?void 0:c.base64,_nk:"iAr".concat(f,"21")},e.pid)})),(!C||0===C.length)&&Object(p["jsx"])("div",{className:"text-center text-gray-500 h-36 flex items-center justify-center font-bold text-lg",_nk:"".concat(f,"13"),children:"\u60a8\u672a\u9009\u62e9\u5546\u54c1"})]}),P=Object(d["useState"])(),T=Object(s["a"])(P,2),A=T[0],E=T[1],F=function(){var e=Object(a["a"])(i.a.mark((function e(t){var n;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(l["h"])({params:{pid:t}});case 3:n=e.sent,n&&n.status&&E(n.result.canteen),e.next=9;break;case 7:e.prev=7,e.t0=e["catch"](0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),V=A&&Object(p["jsxs"])("div",{className:"bg-white px-6 py-3 mx-4 rounded mt-1",_nk:"".concat(f,"14"),children:[Object(p["jsxs"])("div",{className:"flex items-center justify-between ",_nk:"".concat(f,"15"),children:[Object(p["jsxs"])("div",{_nk:"".concat(f,"16"),children:[Object(p["jsx"])("div",{className:"text-lg font-semibold",_nk:"".concat(f,"17"),children:A.name}),Object(p["jsx"])("div",{_nk:"".concat(f,"18"),children:A.introduction})]}),Object(p["jsxs"])("div",{className:"flex items-end justify-end w-32",_nk:"".concat(f,"19"),children:["\u5c0f\u8ba1\uffe5",Object(p["jsx"])("div",{className:"text-2xl font-semibold",_nk:"".concat(f,"1a"),children:y})]})]}),Object(p["jsxs"])("div",{className:"flex mt-2 items-center sticky bottom-0",_nk:"".concat(f,"1b"),children:[Object(p["jsx"])("div",{className:"font-semibold w-16",_nk:"".concat(f,"1c"),children:"\u5907\u6ce8"}),Object(p["jsx"])("input",{value:v.extraInfo,onChange:e=>{k(Object(c["a"])(Object(c["a"])({},v),{},{extraInfo:e.target.value}))},className:"block appearance-none text-xs placeholder-gray-500 placeholder-opacity-100 border border-light-blue-400 rounded-md w-full py-1 px-4 text-gray-700 leading-5 focus:outline-none focus:ring-1 focus:ring-light-blue-300",placeholder:"\u8bf7\u5728\u6b64\u5904\u586b\u5199\u5907\u6ce8",_nk:"".concat(f,"31")})]})]});Object(d["useEffect"])((()=>{F(t.id),L(t.id)}),[]);var W=function(){var e=Object(a["a"])(i.a.mark((function e(t){var n;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(l["o"])({params:{pid:t}});case 2:n=e.sent,n&&n.status?r(n.result,"/canteen/user/record"):(b["a"].show("\u5524\u9192\u652f\u4ed8\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u5728\u5217\u8868\u9875\u8fdb\u884c\u652f\u4ed8"),j["a"].replace("/canteen/user/record"));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Y=Object(d["useState"])(!1),q=Object(s["a"])(Y,2),z=q[0],B=q[1],D=function(){var e=Object(a["a"])(i.a.mark((function e(){var t,n,c;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!==y){e.next=3;break}return b["a"].show("\u603b\u4ef7\u4e3a0\uff0c\u8bf7\u786e\u8ba4\u5546\u54c1\u9009\u62e9"),e.abrupt("return");case 3:if(null!==(t=v.itemList)&&void 0!==t&&t.length){e.next=6;break}return b["a"].show("\u8bf7\u9009\u62e9\u83dc\u54c1"),e.abrupt("return");case 6:if(!z){e.next=8;break}return e.abrupt("return");case 8:return B(!0),e.prev=9,e.next=12,Object(l["a"])({data:v});case 12:n=e.sent,n&&n.status?(B(!1),n.result.orderId&&(b["a"].show(n.message),n.result.orderId&&W(n.result.orderId)),n.result.orderId||(c=x["a"].alert({title:"\u4e0b\u5355\u5931\u8d25",content:Object(p["jsxs"])("div",{_nk:"".concat(f,"1d"),children:[Object(p["jsx"])("div",{_nk:"".concat(f,"1e"),children:n.message}),Object(p["jsxs"])("div",{_nk:"".concat(f,"1f"),children:["\u65e0\u6cd5\u8d2d\u4e70\u4ea7\u54c1\uff1a",n.result.name]})]}),onCancel:()=>{c.hide()}}))):B(!1),e.next=19;break;case 16:e.prev=16,e.t0=e["catch"](9),B(!1);case 19:case"end":return e.stop()}}),e,null,[[9,16]])})));return function(){return e.apply(this,arguments)}}(),K=Object(p["jsx"])("div",{className:"fixed bottom-2 px-3 w-screen max-w-md mx-auto",_nk:"".concat(f,"1g"),children:Object(p["jsxs"])("div",{className:"flex w-fulltext-gray-800 justify-between bg-gray-700 rounded-full",_nk:"".concat(f,"1h"),children:[Object(p["jsx"])("div",{className:"flex justify-between px-6 py-2 text-white",_nk:"".concat(f,"1i"),children:Object(p["jsx"])("div",{className:"flex justify-between items-center",_nk:"".concat(f,"1j"),children:Object(p["jsx"])("div",{className:"text-left text-base",_nk:"".concat(f,"1k"),children:Object(p["jsxs"])("p",{_nk:"".concat(f,"41"),children:["\uffe5",Object(p["jsxs"])("span",{className:"font-semibold",_nk:"".concat(f,"51"),children:[y," \u5143"]})]})})})}),Object(p["jsx"])("div",{onClick:D,className:"flex justify-center items-center font-semibold bg-gradient-to-r from-yellow-300 to-yellow-400  px-6 rounded-r-full",_nk:"".concat(f,"1l"),children:"\u652f\u4ed8"})]})});return Object(p["jsx"])(p["Fragment"],{children:Object(p["jsxs"])("div",{className:"min-h-screen",_nk:"".concat(f,"1m"),children:[Object(p["jsx"])("div",{className:"sticky top-0 z-10",_nk:"".concat(f,"1n"),children:Object(p["jsx"])(o["a"],{title:"\u4ed8\u6b3e",_nk:"".concat(f,"61")})}),J,V,K,Object(p["jsx"])("div",{className:"h-24",_nk:"".concat(f,"1o")})]})})};t["default"]=m}}]);